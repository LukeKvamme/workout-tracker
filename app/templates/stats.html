{% extends "base.html" %}
{% block title %}Fitness Stats and Analytics{% endblock %}
{% block content %}

    <style>
        :root {
            --primary-color: #2196F3;
            --primary-dark: #1976D2;
            --primary-light: #BBDEFB;
            --secondary-color: #4CAF50;
            --accent-color: #FF9800;
            --text-dark: #333;
            --text-light: #FFF;
            --text-muted: #757575;
            --background-light: #F5F5F5;
            --background-card: #FFFFFF;
            --border-color: #E0E0E0;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
            --chart-color-1: rgba(33, 150, 243, 0.8);
            --chart-color-2: rgba(76, 175, 80, 0.8);
            --chart-color-3: rgba(255, 152, 0, 0.8);
            --chart-color-4: rgba(156, 39, 176, 0.8);
            --chart-color-5: rgba(233, 30, 99, 0.8);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--text-light);
            padding: 1.5rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-title {
            font-size: 2rem;
            font-weight: 600;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-link {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 4px;
            transition: var(--transition);
        }
        
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .page-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .section {
            background: var(--background-card);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-controls {
            background: var(--background-card);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex-grow: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-muted);
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
            border-radius: 4px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--background-card);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: var(--background-card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-dark);
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-wrapper {
            height: 350px;
            position: relative;
        }
        
        .time-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .comparison-card {
            background: var(--background-card);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        .comparison-header {
            background: var(--primary-dark);
            color: var(--text-light);
            padding: 15px;
            font-weight: 500;
        }
        
        .comparison-body {
            padding: 15px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .comparison-item {
            border-bottom: 1px solid var(--border-color);
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .comparison-label {
            color: var(--text-muted);
        }
        
        .comparison-value {
            font-weight: 500;
        }
        
        .positive-change {
            color: var(--secondary-color);
        }
        
        .negative-change {
            color: #F44336;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            transition: var(--transition);
            color: var(--text-muted);
        }
        
        .tab:hover {
            color: var(--primary-color);
        }
        
        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .exercise-list {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .exercise-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .exercise-item:hover {
            background-color: var(--primary-light);
        }
        
        .exercise-item.selected {
            background-color: var(--primary-light);
            font-weight: 500;
        }
        
        .exercise-name {
            font-weight: 500;
        }
        
        .exercise-meta {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .no-data {
            text-align: center;
            padding: 40px 0;
            color: var(--text-muted);
        }
        
        .exercise-stats {
            background: var(--background-card);
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            margin-top: 30px;
            display: none;
        }
        
        .exercise-stats.active {
            display: block;
        }
        
        .progress-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .progress-table th, .progress-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .progress-table th {
            background-color: var(--background-light);
            font-weight: 500;
        }
        
        .progress-table tr:hover {
            background-color: var(--background-light);
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .app-title {
                margin-bottom: 15px;
            }
            
            .nav-links {
                justify-content: center;
            }
            
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <main class="container">
        <h1 class="page-title">Stats & Analytics</h1>
        
        <!-- Date Range Controls -->
        <div class="stats-controls">
            <form id="dateRangeForm" method="get">
                <div class="control-group">
                    <div class="form-group">
                        <label for="start_date">Start Date</label>
                        <input type="date" id="start_date" name="start_date" class="form-control" 
                               value="{{ request.args.get('start_date', default_start) }}">
                    </div>
                    <div class="form-group">
                        <label for="end_date">End Date</label>
                        <input type="date" id="end_date" name="end_date" class="form-control"
                               value="{{ request.args.get('end_date', default_end) }}">
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button type="submit" class="btn">Apply Filters</button>
                    </div>
                </div>
                <div class="control-group">
                    <button type="button" class="btn" onclick="setDateRange('all')">All Time</button>
                    <button type="button" class="btn" onclick="setDateRange('year')">This Year</button>
                    <button type="button" class="btn" onclick="setDateRange('month')">This Month</button>
                    <button type="button" class="btn" onclick="setDateRange('week')">This Week</button>
                </div>
            </form>
        </div>
        
        <!-- Overall Stats Summary -->
        <section class="section">
            <h2 class="section-title">Overall Statistics</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">🏋️</span>
                    <span class="stat-value">{{ overall_stats.total_workouts }}</span>
                    <span class="stat-label">Total Workouts</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">⏱️</span>
                    <span class="stat-value">{{ overall_stats.total_time }}</span>
                    <span class="stat-label">Total Hours</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">💪</span>
                    <span class="stat-value">{{ overall_stats.total_sets }}</span>
                    <span class="stat-label">Total Sets</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">🔄</span>
                    <span class="stat-value">{{ overall_stats.total_reps }}</span>
                    <span class="stat-label">Total Reps</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">⚖️</span>
                    <span class="stat-value">{{ overall_stats.total_volume|int }}</span>
                    <span class="stat-label">Total Volume (lbs)</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">📊</span>
                    <span class="stat-value">{{ overall_stats.max_weight }}</span>
                    <span class="stat-label">Max Weight (lbs)</span>
                </div>
            </div>
        </section>
        
        <!-- Time Comparison -->
        <section class="section">
            <h2 class="section-title">Time Comparison</h2>
            
            <div class="time-comparison">
                <div class="comparison-card">
                    <div class="comparison-header">
                        Weekly Comparison
                    </div>
                    <div class="comparison-body">
                        <div class="comparison-grid">
                            <div class="comparison-item">
                                <span class="comparison-label">Workouts</span>
                                <div>
                                    <span class="comparison-value">{{ comparisons.current_week.workouts }}</span>
                                    {% if comparisons.current_week.workouts_change > 0 %}
                                    <span class="positive-change"> +{{ comparisons.current_week.workouts_change }}%</span>
                                    {% elif comparisons.current_week.workouts_change < 0 %}
                                    <span class="negative-change"> {{ comparisons.current_week.workouts_change }}%</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="comparison-item">
                                <span class="comparison-label">Volume</span>
                                <div>
                                    <span class="comparison-value">{{ comparisons.current_week.volume|int }}</span>
                                    {% if comparisons.current_week.volume_change > 0 %}
                                    <span class="positive-change"> +{{ comparisons.current_week.volume_change }}%</span>
                                    {% elif comparisons.current_week.volume_change < 0 %}
                                    <span class="negative-change"> {{ comparisons.current_week.volume_change }}%</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="comparison-card">
                    <div class="comparison-header">
                        Monthly Comparison
                    </div>
                    <div class="comparison-body">
                        <div class="comparison-grid">
                            <div class="comparison-item">
                                <span class="comparison-label">Workouts</span>
                                <div>
                                    <span class="comparison-value">{{ comparisons.current_month.workouts }}</span>
                                    {% if comparisons.current_month.workouts_change > 0 %}
                                    <span class="positive-change"> +{{ comparisons.current_month.workouts_change }}%</span>
                                    {% elif comparisons.current_month.workouts_change < 0 %}
                                    <span class="negative-change"> {{ comparisons.current_month.workouts_change }}%</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="comparison-item">
                                <span class="comparison-label">Volume</span>
                                <div>
                                    <span class="comparison-value">{{ comparisons.current_month.volume|int }}</span>
                                    {% if comparisons.current_month.volume_change > 0 %}
                                    <span class="positive-change"> +{{ comparisons.current_month.volume_change }}%</span>
                                    {% elif comparisons.current_month.volume_change < 0 %}
                                    <span class="negative-change"> {{ comparisons.current_month.volume_change }}%</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="comparison-card">
                    <div class="comparison-header">
                        Yearly Comparison
                    </div>
                    <div class="comparison-body">
                        <div class="comparison-grid">
                            <div class="comparison-item">
                                <span class="comparison-label">Workouts</span>
                                <div>
                                    <span class="comparison-value">{{ comparisons.current_year.workouts }}</span>
                                    {% if comparisons.current_year.workouts_change > 0 %}
                                    <span class="positive-change"> +{{ comparisons.current_year.workouts_change }}%</span>
                                    {% elif comparisons.current_year.workouts_change < 0 %}
                                    <span class="negative-change"> {{ comparisons.current_year.workouts_change }}%</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="comparison-item">
                                <span class="comparison-label">Volume</span>
                                <div>
                                    <span class="comparison-value">{{ comparisons.current_year.volume|int }}</span>
                                    {% if comparisons.current_year.volume_change > 0 %}
                                    <span class="positive-change"> +{{ comparisons.current_year.volume_change }}%</span>
                                    {% elif comparisons.current_year.volume_change < 0 %}
                                    <span class="negative-change"> {{ comparisons.current_year.volume_change }}%</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Charts -->
        <section class="section">
            <h2 class="section-title">Performance Trends</h2>
            
            <div class="chart-container">
                <div class="chart-card">
                    <div class="chart-title">
                        <span>Workout Volume Over Time</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">
                        <span>Workouts by Muscle Group</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="muscleGroupChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-card">
                    <div class="chart-title">
                        <span>Workout Frequency</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="frequencyChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">
                        <span>Top Exercises by Volume</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="topExercisesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Exercise-Specific Stats -->
        <section class="section">
            <h2 class="section-title">Exercise-Specific Statistics</h2>
            
            <div class="tabs">
                <div class="tab active" data-tab="exercises">Exercises</div>
                <div class="tab" data-tab="muscles">Muscle Groups</div>
            </div>
            
            <div class="tab-content active" id="exercises-tab">
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group" style="flex-grow: 1;">
                        <input type="text" id="exercise-search" class="form-control" placeholder="Search exercises...">
                    </div>
                </div>
                
                <div class="exercise-list">
                    {% if all_exercises %}
                        {% for exercise in all_exercises %}
                        <div class="exercise-item" data-exercise-id="{{ exercise.id }}" onclick="selectExercise({{ exercise.id }})">
                            <div>
                                <div class="exercise-name">{{ exercise.name }}</div>
                                <div class="exercise-meta">
                                    {% if exercise.equipment %}{{ exercise.equipment }}{% else %}Bodyweight{% endif %}
                                    • 
                                    {% if exercise.stats %}Last used: {{ exercise.stats.last_used }}{% else %}Never used{% endif %}
                                </div>
                            </div>
                            <div>
                                {% if exercise.stats %}
                                <div class="exercise-meta">
                                    Max: {{ exercise.stats.max_weight }} lbs
                                    • 
                                    {{ exercise.stats.total_sets }} sets
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-data">No exercises found</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="tab-content" id="muscles-tab">
                <div class="exercise-list">
                    {% if all_muscles %}
                        {% for muscle in all_muscles %}
                        <div class="exercise-item" data-muscle="{{ muscle.muscle }}" onclick="selectMuscle('{{ muscle.muscle }}')">
                            <div>
                                <div class="exercise-name">{{ muscle.muscle }}</div>
                                <div class="exercise-meta">
                                    {{ muscle.exercise_count }} exercises • 
                                    {{ muscle.total_sets }} total sets
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-data">No muscle data found</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Exercise specific stats (hidden by default, shown when an exercise is selected) -->
            <div id="exercise-specific-stats" class="exercise-stats">
                <h3 id="selected-exercise-name">Exercise Name</h3>
                
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <span class="stat-value" id="exercise-total-sets">0</span>
                        <span class="stat-label">Total Sets</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="exercise-total-reps">0</span>
                        <span class="stat-label">Total Reps</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="exercise-max-weight">0</span>
                        <span class="stat-label">Max Weight</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="exercise-total-volume">0</span>
                        <span class="stat-label">Total Volume</span>
                    </div>
                </div>
                
                <div class="chart-container" style="margin-top: 30px;">
                    <div class="chart-card">
                        <div class="chart-title">
                            <span>Progress Over Time</span>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="exerciseProgressChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">Recent Sets</h3>
                <table class="progress-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Set</th>
                            <th>Weight</th>
                            <th>Reps</th>
                            <th>Volume</th>
                        </tr>
                    </thead>
                    <tbody id="exercise-sets-table">
                        <!-- Sets will be loaded here via AJAX -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize charts
        document.addEventListener('DOMContentLoaded', function() {
            // Volume Over Time Chart
            const volumeChartCtx = document.getElementById('volumeChart').getContext('2d');
            const volumeChart = new Chart(volumeChartCtx, {
                type: 'line',
                data: {
                    labels: {{ volume_chart.labels|tojson }},
                    datasets: [{
                        label: 'Workout Volume',
                        data: {{ volume_chart.data|tojson }},
                        backgroundColor: 'rgba(33, 150, 243, 0.2)',
                        borderColor: 'rgba(33, 150, 243, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(33, 150, 243, 1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Volume (lbs)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    }
                }
            });
            
            // Muscle Group Chart
            const muscleChartCtx = document.getElementById('muscleGroupChart').getContext('2d');
            const muscleChart = new Chart(muscleChartCtx, {
                type: 'pie',
                data: {
                    labels: {{ muscle_chart.labels|tojson }},
                    datasets: [{
                        data: {{ muscle_chart.data|tojson }},
                        backgroundColor: [
                            'rgba(33, 150, 243, 0.8)',
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(156, 39, 176, 0.8)',
                            'rgba(233, 30, 99, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(0, 188, 212, 0.8)',
                            'rgba(63, 81, 181, 0.8)',
                            'rgba(96, 125, 139, 0.8)',
                            'rgba(121, 85, 72, 0.8)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // Frequency Chart
            const frequencyChartCtx = document.getElementById('frequencyChart').getContext('2d');
            const frequencyChart = new Chart(frequencyChartCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Workouts',
                        data: {{ frequency_chart.data|tojson }},
                        backgroundColor: 'rgba(33, 150, 243, 0.8)',
                        borderColor: 'rgba(33, 150, 243, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            },
                            title: {
                                display: true,
                                text: 'Number of Workouts'
                            }
                        }
                    }
                }
            });
            
            // Top Exercises Chart
            const topExercisesChartCtx = document.getElementById('topExercisesChart').getContext('2d');
            const topExercisesChart = new Chart(topExercisesChartCtx, {
                type: 'bar',
                data: {
                    labels: {{ top_exercises.labels|tojson }},
                    datasets: [{
                        label: 'Volume',
                        data: {{ top_exercises.data|tojson }},
                        backgroundColor: 'rgba(76, 175, 80, 0.8)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Total Volume (lbs)'
                            }
                        }
                    }
                }
            });
        });
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                // Show corresponding tab content
                document.getElementById(this.dataset.tab + '-tab').classList.add('active');
            });
        });
        
        // Date range helper functions
        function setDateRange(range) {
            const today = new Date();
            let startDate = new Date();
            
            switch (range) {
                case 'all':
                    // Set to a very early date for "all time"
                    startDate = new Date(2000, 0, 1);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    break;
                case 'week':
                    // Set to beginning of current week (Sunday)
                    const day = today.getDay();
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - day);
                    break;
            }
            
            // Format dates for input fields
            document.getElementById('start_date').value = formatDate(startDate);
            document.getElementById('end_date').value = formatDate(today);
            
            // Submit the form
            document.getElementById('dateRangeForm').submit();
        }
        
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Exercise selection
        function selectExercise(exerciseId) {
            // Remove selected class from all items
            document.querySelectorAll('.exercise-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selected class to clicked item
            document.querySelector(`.exercise-item[data-exercise-id="${exerciseId}"]`).classList.add('selected');
            
            // Show loading state
            document.getElementById('exercise-specific-stats').classList.add('active');
            document.getElementById('selected-exercise-name').textContent = 'Loading...';
            
            // Fetch exercise data
            fetch(`/api/exercise-stats/${exerciseId}`)
                .then(response => response.json())
                .then(data => {
                    // Update exercise stats
                    document.getElementById('selected-exercise-name').textContent = data.name;
                    document.getElementById('exercise-total-sets').textContent = data.total_sets;
                    document.getElementById('exercise-total-reps').textContent = data.total_reps;
                    document.getElementById('exercise-max-weight').textContent = data.max_weight;
                    document.getElementById('exercise-total-volume').textContent = data.total_volume;
                    
                    // Update table
                    const tableBody = document.getElementById('exercise-sets-table');
                    tableBody.innerHTML = '';
                    
                    data.sets.forEach(set => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${set.date}</td>
                            <td>${set.set_number}</td>
                            <td>${set.weight} lbs</td>
                            <td>${set.reps}</td>
                            <td>${set.volume}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // Create progress chart
                    if (window.exerciseProgressChart) {
                        window.exerciseProgressChart.destroy();
                    }
                    
                    const progressChartCtx = document.getElementById('exerciseProgressChart').getContext('2d');
                    window.exerciseProgressChart = new Chart(progressChartCtx, {
                        type: 'line',
                        data: {
                            labels: data.chart.labels,
                            datasets: [{
                                label: 'Max Weight',
                                data: data.chart.max_weight,
                                borderColor: 'rgba(33, 150, 243, 1)',
                                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                                yAxisID: 'y',
                                tension: 0.3
                            }, {
                                label: 'Volume',
                                data: data.chart.volume,
                                borderColor: 'rgba(76, 175, 80, 1)',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                yAxisID: 'y1',
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: 'Weight (lbs)'
                                    }
                                },
                                y1: {
                                    beginAtZero: true,
                                    position: 'right',
                                    grid: {
                                        drawOnChartArea: false
                                    },
                                    title: {
                                        display: true,
                                        text: 'Volume (lbs)'
                                    }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error fetching exercise data:', error);
                    document.getElementById('selected-exercise-name').textContent = 'Error loading exercise data';
                });
        }
        
        // Muscle selection
        function selectMuscle(muscleName) {
            // Remove selected class from all items
            document.querySelectorAll('.exercise-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selected class to clicked item
            document.querySelector(`.exercise-item[data-muscle="${muscleName}"]`).classList.add('selected');
            
            // Show loading state
            document.getElementById('exercise-specific-stats').classList.add('active');
            document.getElementById('selected-exercise-name').textContent = 'Loading...';
            
            // Fetch muscle data
            fetch(`/api/muscle-stats/${encodeURIComponent(muscleName)}`)
                .then(response => response.json())
                .then(data => {
                    // Update muscle stats
                    document.getElementById('selected-exercise-name').textContent = `${muscleName} Muscle Group`;
                    document.getElementById('exercise-total-sets').textContent = data.total_sets;
                    document.getElementById('exercise-total-reps').textContent = data.total_reps;
                    document.getElementById('exercise-max-weight').textContent = data.max_weight || 'N/A';
                    document.getElementById('exercise-total-volume').textContent = data.total_volume;
                    
                    // Update table - show exercises for this muscle
                    const tableBody = document.getElementById('exercise-sets-table');
                    tableBody.innerHTML = '';
                    
                    data.exercises.forEach(exercise => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td colspan="2">${exercise.name}</td>
                            <td>${exercise.max_weight} lbs</td>
                            <td>${exercise.total_sets} sets</td>
                            <td>${exercise.total_volume}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // Create muscle volume chart
                    if (window.exerciseProgressChart) {
                        window.exerciseProgressChart.destroy();
                    }
                    
                    const progressChartCtx = document.getElementById('exerciseProgressChart').getContext('2d');
                    window.exerciseProgressChart = new Chart(progressChartCtx, {
                        type: 'bar',
                        data: {
                            labels: data.chart.labels,
                            datasets: [{
                                label: 'Volume by Day',
                                data: data.chart.values,
                                backgroundColor: 'rgba(156, 39, 176, 0.8)',
                                borderColor: 'rgba(156, 39, 176, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Volume (lbs)'
                                    }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error fetching muscle data:', error);
                    document.getElementById('selected-exercise-name').textContent = 'Error loading muscle data';
                });
        }
        
        // Exercise search functionality
        document.getElementById('exercise-search').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const exerciseItems = document.querySelectorAll('#exercises-tab .exercise-item');
            
            exerciseItems.forEach(item => {
                const exerciseName = item.querySelector('.exercise-name').textContent.toLowerCase();
                
                if (exerciseName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    </script>
    
{% endblock %}